<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Control</title>
</head>
<body>
    <h1>TV Control</h1>
    
    <div id="log">
        <h2>Log:</h2>
        <ul id="logList"></ul>
    </div>

    <script>
        let isVPressed = false;

        const keyMap = {
            'a': 'a',
            'b': 'b',
            'c': 'c',
            'd': 'd',
            'e': 'e',
            'f': 'f',
            'g': 'g',
            'h': 'h',
            'i': 'i',
            'j': 'j',
            'k': 'k',
            'l': 'l',
            'm': 'm',
            'n': 'n',
            'o': 'o',
            'p': 'p',
            'q': 'q',
            'r': 'r',
            's': 's',
            't': 't',
            'u': 'u',
            'w': 'w',
            'x': 'x',
            'y': 'y',
            'z': 'z',
            'ArrowUp': 'up',
            'ArrowDown': 'down',
            'ArrowLeft': 'left',
            'ArrowRight': 'right',
            'Escape': 'escape',
            'Enter': 'enter',
            'Backspace': 'backspace',
            'Tab': 'tab',
            'Shift': 'shift',
            'Control': 'control',
            'Alt': 'alt',
            'CapsLock': 'capslock',
            'Space': 'space',
            'PageUp': 'pageup',
            'PageDown': 'pagedown',
            'End': 'end',
            'Home': 'home',
            'Insert': 'insert',
            'Delete': 'delete',
        };

        function sendKeyPress(key, isVPressed) {
            fetch('/keypress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ key, isVPressed }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    updateLog(data.logEntry);
                })
                .catch(error => console.error('Error:', error));
        }

        function updateLog(logEntry) {
            const logList = document.getElementById('logList');
            const listItem = document.createElement('li');
            listItem.textContent = logEntry;
            logList.appendChild(listItem);

            logList.scrollTop = logList.scrollHeight;
        }

        document.addEventListener('keydown', function (event) {
            const key = keyMap[event.key.toLowerCase()] || event.key.toLowerCase();

            if (key === 'v' && !isVPressed) {
                isVPressed = true;
                sendKeyPress('v_pressed', isVPressed);
            } else if (key !== 'v') {
                sendKeyPress(key, isVPressed);
            }
        });

        document.addEventListener('keyup', function (event) {
            if (event.key === 'v' && isVPressed) {
                isVPressed = false;
                sendKeyPress('v_released', isVPressed);
            }
        });
    </script>
</body>
</html>
